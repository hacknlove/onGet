!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@hacknlove/deepobject"),require("isdifferent")):"function"==typeof define&&define.amd?define("onGet",["@hacknlove/deepobject","isdifferent"],t):"object"==typeof exports?exports.onGet=t(require("@hacknlove/deepobject"),require("isdifferent")):e.onGet=t(e.deepObject,e.isDifferent)}(this,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.r(t);const r={CACHE_SIZE:100},o={},l=[];function u(e){return l.find(t=>e.match(t.regex))}function a(){const e=Object.values(o);e.length<r.CACHE_SIZE||e.forEach(e=>{e.clean?e.plugin.clean&&e.plugin.clean(e)||(clearTimeout(o[e.url].timeout),delete o[e.url]):0===Object.keys(e.callbacks).length&&(e.clean=!0)})}function i(e,t){if(o[e])return o[e];setTimeout(a);const n=u(e);if(!n)throw new Error(`No plugin for ${e}`);const r={url:e,plugin:n,value:t,callbacks:{}};return o[e]=r,n.checkInterval&&(r.intervals={},r.minInterval=1/0),void 0!==n.threshold&&(r.last=-1/0),n.getEndpoint&&n.getEndpoint(r),r}function s(e,t,n){const r=o[e];var l;do{l=Math.random().toString(36).substr(2)+(Date.now()%1e3).toString(36)}while(r.callbacks[l]);return r.callbacks[l]=t,r.intervals&&(n=void 0===n?r.plugin.checkInterval:n,r.intervals[l]=n||1/0,r.minInterval=Math.min(r.minInterval,n)),function(e,t){return()=>{e.callbacks.hasOwnProperty(t)&&(e.plugin.unsubscribe&&e.plugin.unsubscribe(e),delete e.callbacks[t],e.intervals&&(delete e.intervals[t],e.minInterval=Math.min(...Object.values(e.intervals))))}}(r,l)}var c=n(1),f=n.n(c);function v(e){e.intervals&&(clearTimeout(e.timeout),o[e.url]&&(e.last=Date.now(),e.timeout=setTimeout(()=>{g(e.url)},e.minInterval)))}function d(e,t,n){const r=o[e];if(r){if(r.clean=void 0,r.intervals&&n&&v(r),f()(t,r.value))return r.value=t,r.plugin.set&&r.plugin.set(r),Object.values(r.callbacks).forEach(e=>setTimeout(e,0,r.value)),r}else{const n=i(e,t);n.plugin.set&&(n.value=t,n.plugin.set(n))}}function g(e){const t=o[e];return!!t&&(t.clean=void 0,void 0!==t.plugin.threshold&&Date.now()-t.last<t.plugin.threshold?void 0:(v(t),t.plugin.refresh(t,t=>{d(e,t)}),!0))}function h(e,t,n={}){const{first:r,interval:o}=n,l=i(e,r),u=s(e,t,o);return l.clean=void 0,void 0!==l.value&&t(l.value),Date.now()-l.last>l.plugin.threshold&&g(e),u}function p(e){const t=o[e];if(t)return t.clean=void 0,o[e].value;const n=u(e);return n.get?n.get(e):void 0}function b(e){l.unshift(e)}var m={name:"fetch",regex:/^./,checkInterval:3e4,threshold:500,async refresh(e,t){const n=await fetch(e.url).catch(e=>({error:e}));if(n.error)return t(n.error);t(await n.json().catch(async()=>n.text()))}};const y="localStorage://".length;var k={name:"localStorage",regex:/^localStorage:\/\/./i,checkInterval:3e4,threshold:500,refresh(e,t){t(localStorage[e.key])},getEndpoint(e){e.key=e.url.substr(y),void 0===localStorage[e.key]?localStorage[e.key]=e.value:e.value=localStorage[e.key]},get:e=>localStorage[e.substr(y)],set(e){localStorage[e.key]=e.value}};const j="sessionStorage://".length;var S={name:"sessionStorage",regex:/^sessionStorage:\/\/./i,checkInterval:3e4,threshold:500,refresh(e,t){t(sessionStorage[e.key])},getEndpoint(e){e.key=e.url.substr(j),void 0===sessionStorage[e.key]?sessionStorage[e.key]=e.value:e.value=sessionStorage[e.key]},get:e=>sessionStorage[e.substr(j)],set(e){sessionStorage[e.key]=e.value}},O=n(0),x={};function E(e){const t=e.replace(/\.?[^.]*$/,"");if(!t)return;const n=o[t];n&&(n.value=Object(O.getValue)(x,n.url),Object.values(n.callbacks).forEach(e=>setTimeout(e,0,n.value))),setTimeout(E,0,t)}function w(e){const t=o[e],n=`${e}.`;Object.keys(o).forEach(r=>{if(!r.startsWith(n))return;const l=o[r],u=Object(O.getValue)(t.value,r.substr(e.length+1));f()(u,l.value)&&(l.value=u,Object.values(l.callbacks).forEach(e=>setTimeout(e,0,u)))})}var I={name:"state",regex:/^state:\/\/./,refresh(){console.warn("the true source for this plugin is client side, so refresh does nothing")},getEndpoint(e){const t=Object(O.getValue)(x,e.url);if(void 0===t)return x=Object(O.setValue)(x,e.url,e.value),E(e.url),void w(e.url);e.value=t},get:e=>Object(O.getValue)(x,e),set(e){x=Object(O.setValue)(x,e.url,e.value),E(e.url),w(e.url)},clean(e){const t=`${e.url}.`;Object.keys(o).some(e=>e.startsWith(t))||(Object(O.deleteValue)(x,e.url),E(e.url))}};n.d(t,"onGet",(function(){return h})),n.d(t,"set",(function(){return d})),n.d(t,"refresh",(function(){return g})),n.d(t,"get",(function(){return p})),n.d(t,"registerPlugin",(function(){return b})),n.d(t,"conf",(function(){return r})),n.d(t,"endpoints",(function(){return o})),n.d(t,"plugins",(function(){return l})),b(m),b(k),b(S),b(I)}])}));
