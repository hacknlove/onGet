!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@hacknlove/deepobject"),require("isdifferent"),require("react")):"function"==typeof define&&define.amd?define("onGet",["@hacknlove/deepobject","isdifferent","react"],t):"object"==typeof exports?exports.onGet=t(require("@hacknlove/deepobject"),require("isdifferent"),require("react")):e.onGet=t(e.deepObject,e.isDifferent,e.React)}(this,(function(e,t,n){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";n.r(t);const r={CACHE_SIZE:100},o={},u=[];function l(e){return u.find(t=>e.match(t.regex))}function a(){const e=Object.values(o);e.length<r.CACHE_SIZE||e.forEach(e=>{e.clean?e.plugin.clean&&e.plugin.clean(e)||(clearTimeout(o[e.url].timeout),delete o[e.url]):0===Object.keys(e.callbacks).length&&(e.clean=!0)})}function s(e,t){if(o[e])return o[e];setTimeout(a);const n=l(e);if(!n)throw new Error(`No plugin for ${e}`);const r={url:e,plugin:n,value:t,callbacks:{}};return o[e]=r,n.checkInterval&&(r.intervals={},r.minInterval=1/0),void 0!==n.threshold&&(r.last=-1/0),n.getEndpoint&&n.getEndpoint(r),r}function i(e,t,n){const r=o[e];var u;do{u=Math.random().toString(36).substr(2)+(Date.now()%1e3).toString(36)}while(r.callbacks[u]);return r.callbacks[u]=t,r.intervals&&(n=n||r.plugin.checkInterval,r.intervals[u]=n,r.minInterval=Math.min(r.minInterval,n)),function(e,t){return()=>{e.callbacks.hasOwnProperty(t)&&(delete e.callbacks[t],e.intervals&&(delete e.intervals[t],e.minInterval=Math.min(...Object.values(e.intervals))))}}(r,u)}var c=n(1),f=n.n(c);function v(e){e.intervals&&(clearTimeout(e.timeout),o[e.url]&&(e.last=Date.now(),e.timeout=setTimeout(()=>{g(e.url)},e.minInterval)))}function d(e,t,n){const r=o[e];if(r)r.clean=void 0,r.intervals&&n&&v(r),f()(t,r.value)&&(r.value=t,r.plugin.set&&r.plugin.set(r),Object.values(r.callbacks).forEach(e=>setTimeout(e,0,r.value)));else{const n=s(e,t);n.plugin.set&&(n.value=t,n.plugin.set(n))}}function g(e){const t=o[e];return!!t&&(t.clean=void 0,void 0!==t.plugin.threshold&&Date.now()-t.last<t.plugin.threshold?void 0:(v(t),t.plugin.refresh(t,t=>{d(e,t)}),!0))}function h(e,t,n={}){const{first:r,interval:o}=n,u=s(e,r),l=i(e,t,o);return u.clean=void 0,void 0!==u.value&&t(u.value),Date.now()-u.last>u.plugin.threshold&&g(e),l}function p(e){const t=o[e];if(t)return t.clean=void 0,o[e].value;const n=l(e);return n.get?n.get(e):void 0}const{useState:b,useEffect:m}=n(2);function y(e,t){const[n,r]=b(()=>p(e)||t.first);return m(()=>h(e,r,t),[e]),n}function k(e){u.unshift(e)}var j={name:"fetch",regex:/^./,checkInterval:3e4,threshold:500,async refresh(e,t){const n=await fetch(e.url).catch(e=>({error:e}));if(n.error)return t(n.error);t(await n.json().catch(async()=>n.text()))}};const S="localStorage://".length;var O={name:"localStorage",regex:/^localStorage:\/\/./i,checkInterval:3e4,threshold:500,refresh(e,t){t(localStorage[e.key])},getEndpoint(e){e.key=e.url.substr(S),void 0===localStorage[e.key]?localStorage[e.key]=e.value:e.value=localStorage[e.key]},get:e=>localStorage[e.substr(S)],set(e){localStorage[e.key]=e.value}};const x="sessionStorage://".length;var E={name:"sessionStorage",regex:/^sessionStorage:\/\/./i,checkInterval:3e4,threshold:500,refresh(e,t){t(sessionStorage[e.key])},getEndpoint(e){e.key=e.url.substr(x),void 0===sessionStorage[e.key]?sessionStorage[e.key]=e.value:e.value=sessionStorage[e.key]},get:e=>sessionStorage[e.substr(x)],set(e){sessionStorage[e.key]=e.value}},w=n(0),I={};function T(e){const t=e.replace(/\.?[^.]*$/,"");if(!t)return;const n=o[t];n&&(n.value=Object(w.getValue)(I,n.url),Object.values(n.callbacks).forEach(e=>setTimeout(e,0,n.value))),setTimeout(T,0,t)}function _(e){const t=o[e],n=`${e}.`;Object.keys(o).forEach(r=>{if(!r.startsWith(n))return;const u=o[r],l=Object(w.getValue)(t.value,r.substr(e.length+1));f()(l,u.value)&&(u.value=l,Object.values(u.callbacks).forEach(e=>setTimeout(e,0,l)))})}var M={name:"state",regex:/^state:\/\/./,refresh(){console.warn("the true source for this plugin is client side, so refresh does nothing")},getEndpoint(e){const t=Object(w.getValue)(I,e.url);if(void 0===t)return I=Object(w.setValue)(I,e.url,e.value),T(e.url),void _(e.url);e.value=t},get:e=>Object(w.getValue)(I,e),set(e){I=Object(w.setValue)(I,e.url,e.value),T(e.url),_(e.url)},clean(e){const t=`${e.url}.`;Object.keys(o).some(e=>e.startsWith(t))||T(e.url)}};n.d(t,"onGet",(function(){return h})),n.d(t,"useOnGet",(function(){return y})),n.d(t,"set",(function(){return d})),n.d(t,"refresh",(function(){return g})),n.d(t,"get",(function(){return p})),n.d(t,"registerPlugin",(function(){return k})),n.d(t,"conf",(function(){return r})),n.d(t,"endpoints",(function(){return o})),n.d(t,"plugins",(function(){return u})),k(j),k(O),k(E),k(M)}])}));